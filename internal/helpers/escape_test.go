package helpers

import (
	"testing"

	"github.com/smartystreets/goconvey/convey"
)

func TestEscapeIllegalCharacters(t *testing.T) {
	const src = `{
    "id": "0x7547cd12eaff6068f592de37cf9f2bca6b98caaed4cab2b70bd5605e239fc252",
    "ipfs": "bafkreigduw37kuoileclcotrbux2igd5orutfu23rmuxjoycikpio2ku4m",
    "author": "0xcAC131c219A51abcCD597c45a766B1928b17a301",
    "created": 1690005795,
    "network": "1",
    "symbol": "VOTE",
    "type": "single-choice",
    "strategies": [
      {
        "name": "whitelist",
        "network": "1",
        "params": {
          "addresses": [
            "0x3aC75Ef6dCAEAd72C4c1B0e6394938e8a2fCc660",
            "0x7898ad3443204358F37e9f6C087E62E6933e44b5",
            "0xB534Cb031E64270Ac8E896060643A6cD0f14F6b6",
            "0xBD85D988Ee35b593C59264645DE7207c701E694e",
            "0x4676c404364BbF3C5867ED93dC3Ff3b7C34f0ae1",
            "0x576Cd73f0bD3F86d2eb4C9937C90bb06d24a3855",
            "0xcf0576885AE3135DC14A050E86582E943a68CdB6",
            "0x3e55E989A5F71c3eD420BFe82A6a6028701D99e6",
            "0x5C7cfdC5893573d697b9dff2eA2c94027C746b62",
            "0x504de8BD11d0D60a42F460257e66E2736704D08D",
            "0xF88faab16fF122ba7793312e12874faeCfd30238",
            "0x57DCaC3f8a2586A3AA4138a47d6370F2c8c622F2",
            "0xb1200e77F512894716FCEbF0B256531495612B4e",
            "0x9e81f026d295c304cE0801C1d97EF709d2c5Fd98",
            "0xeF61629E19e44422E13DD59aA456eC2304845267",
            "0xF714C66bf05A287319ac06140f5382218a3df710",
            "0x2dc8E974C896F54Ad37844927E99607622503B2e",
            "0x4FCA6278B8CA591ead189444d1620fE4B64332db",
            "0xcD5F032e281b7a9ec463678495236b6036B00c99",
            "0x7cE6a25499f52d56E1dB90f4F871df3Dd41Da623",
            "0x0417e64799FB6A54192fCeb7bED687FEd5572e74",
            "0xa8dE47F6dB2b632b36D82c66fd473Bc99B7eCfed",
            "0x0eC2E9CC396fC21B05349A23814cab9C6bAeC465",
            "0xcfaEDC143dAE84B832d2370C2aEcD86209A56E23",
            "0xeeceb23C70A4f9fA6B1B763c4829209B34104dE1",
            "0xB4D702F27F09Bed83be435f260313b662528B28f",
            "0x0fd584F0E2f0afAbd1c2415b3165F51648bcd1E6",
            "0x7B9d8E41B06CdA189878C485b46375e14D684DcC",
            "0x81ac1bD87941053bfA5d422C92dadC37322D370a",
            "0x25e549E406923D1ABCbc02F50410bD4b2cf3450f",
            "0xADa7cae7132780487dA7723Ac30B3f010346020e",
            "0xFbdE0492f45DeE1527e2214b5023e23300Ae5723",
            "0x46b6EAa23aB98969BAA22a2B5c20c271e5e262A7",
            "0x775843Df27D96c604cC01bAB2204B27Ea93C8da7",
            "0xBFD1E0795f4Aa73F22Eeb7f71aA5521Bd8f5Aec0",
            "0x33BD2415202AA51c559908fB341E644F272bA411",
            "0xAbfC5eFd58Fe55929EF9e237a15CD825eb2c2714",
            "0x2286bae475c9d72311e3d36c99945aF49c4D7EE8",
            "0xB5f9f17d27d00Ba7D2bD90D14B2b1FA3BE293CAC",
            "0x0a70d97ED24F10c7D840A42a7C2c885B9C0c2774",
            "0x3Afa33Cec385D164c12D71fe3F50787b5Cc6e16F",
            "0x2639B1A7E9bf0E4522440882b461Ebe29b27240f",
            "0xd6df4D8972c979650d7Ce18e1F0Af8D941CafD3B",
            "0xa936EA516bd50A3fB599D6F5804850f8E189A169",
            "0xC6A4127F3aACFb265E735Dd9cAa1Dd6B200f710a",
            "0x747626a7F42c2F7C95B0108078431Cd379DCBD86",
            "0x2c3bADD852Ef492755E9C852285395F60B61A44d",
            "0x777A19fE46520a3d5Aa9aCAa31945BFcA39fA8f0",
            "0x66CCD8b69A493A509dB77c355D04F493c2136644",
            "0x750683d6ACaFe3644Fe33D5E8295d79168132f5D",
            "0x0ff1212E46D1c529176781B5443C03366eE50009",
            "0x25D38d8fA150E0A45E207De2aDFf9ac588580854",
            "0x121D1e1d28Bf4fBDF82D5DcdBce375E5A816f270",
            "0x3A77834cfd434BBBFEAe4fA250d87B3527c1F00F",
            "0x82C5932e0f45e50786Dcd1c87C43566B621A16B7",
            "0x42769bdFd74cE57B192dcb2a2530D8a33C5f6Df2",
            "0x27D28f5B8f397B2b65749Db1E3ce823411A1C2A5",
            "0x4829C38bAA09A6b84ec6f6F0Fd06f500e3624E55",
            "0x21a134bAc78679DFB43A83De27D63c24A48ee55C",
            "0xE8c23c0324FB0f7Dc427947d63Fa6602Dd174a85",
            "0x6DD58C5d825149912Ac7BA4C355DD03057111111",
            "0x8cA1344a4a35775cebba70329032d45b40222222",
            "0xab00379076B63907D178c5f8337BDF8261333333",
            "0x44b29619b8BE0c82D3EE1C0463ac8058f8444444",
            "0xAa9Df533F235D4c8f975ed17f41038F992555555",
            "0xb7302AD557c16D5d11B0e60B6f9B48D8Db666666",
            "0x238752D7a526E3684Ca8D18cBD01f57fEA777777",
            "0xB4cd5dF387c747410947cc7E6cc634Bd98888888",
            "0x7a350F5b63FC2d9d92867a54a37E2b9BC6999999",
            "0x19F46EF9e825C07DB89bDc94083833f2BA000000",
            "0xf1c67704B9617da910E4A73673Dc5a5FC6666666",
            "0x844290e4290109A0DC5B9893Dc26BeA847666666",
            "0x8888882ff1BAA256D0d5776Bd10F341551601e28",
            "0x666666d6F4Ed5917301BdFcCd77d9dc6fB6c51cA",
            "0xa7a41BE653ed671672D69EF67e90A56c20999999",
            "0x33333355CBE5ceB9C009A3102071c1B7F98De8d5",
            "0xc15D3c012b14C4C11579d9d21eA5504693999999",
            "0x6666668716020CFa723ab990687Cf29BFaf281F3",
            "0x666666CaB35261E5a3626c74767912cca35045FA",
            "0xC74f8828C4F73f0D823fadD75306D442e8222222",
            "0x52960e2dfb7F33c234946188b97A9800444b6aaF",
            "0x012b40f69933Cf5261BFc3F66b361F29Ffa71deD",
            "0xe0090Aca39c33eF9b3A8B98Cb6f1EEB6D25b485F",
            "0x8e7b8d877a2BaBF6cd02b11D8BD9d963426F330e",
            "0xa3b528C4Eb547F05c4ec681bC87D24F58847F1a6",
            "0xd29Cc098BD5b2eb15Ccf9f73D508247409Db018f",
            "0x9283A0CF8025b2DF8bc309f0E43E95312e07eC9d",
            "0x53d6fc71379Aa5f86D0eE4885F907Fe342760B27",
            "0xa5143c2b375a7DfeC73D0D83C32CdBEcc0375dfB",
            "0xCdF75EFCEb0E368a6125Fc116dF878DbC9bA0Ad8",
            "0x651C2EBF7eE81070D3d083f143dB0c4be6fE02d2",
            "0xB7b8574E029C583A38dC3D2EfbdF47a2E34F7fa8",
            "0x93Bc4e1803BeA1339691c362938a5D5D813414c2",
            "0xe202dE449521762835545dAb9c887ad1D9baF008",
            "0x9edDD90037B707E941335c390a3Ba72c1f4e14Fd",
            "0x032101aA4AB8E2148204038c40677BD188900b6a",
            "0x95d696a9CA6168D903Eb0A2d51165a70456EfC3a",
            "0xa31857eb5369987bbc99C0a09239CA6d379a6718",
            "0x0e89b7fF5642305d639a9a5d68514919adBA43B8",
            "0x865803b1E8304e8E2EF9bcA779Db00D26B6f08A1",
            "0xb197d0A67D96A5Ea5A642Fbd5De116BF33378611",
            "0xa7A1aF7EBb0Ff4c0b679dA93D984b7E1ee58c43e",
            "0xac111b58Ca5D29a8C558D83D80bF512766a09C1a",
            "0x2834cbF533128D193B23Fe2aD5efb4Ac40Ed07Ae",
            "0xe8e845eb7fe30880da72C504FE182EdA16D90749",
            "0x0211773AE9e7E15DE8993F9D8383AD9F67c5eAff",
            "0x721ed6425B2EdFD387871fDb3F468f4155d26E29",
            "0xDB0ceBA793Dd61a081712674c8D1B90780ff954a",
            "0x6e9Eb41D8dcFE7487c279fa89586EC621E29612a",
            "0xc01EB09cb132973B22491D585d027008788264C8",
            "0x795A8A2D6beC892eF8fae69d3B7C317047999999",
            "0x6466F883b8882f3990484962f237089550999999",
            "0xE6c2BA09fA4212D89429E0eC9B485110c8333333",
            "0x9999996701301CCe14A80D5EF924F926BBcF9D81",
            "0x1111115C10B409513D9639d8e5B753d5D1b05859",
            "0x0000002839782D9927cb53e91010258D4DB007b0",
            "0x0000008B285Aa8e8Bd3B62aa02A92D6FF20d6B89",
            "0x2222226B078f79f74d3633a8Ce7fBfeBAa76c893",
            "0x444444681A1aec19d703900f6Cc47Dde16e7c4bB",
            "0x333333056aBd01A74a6308e4EF13229cDBc8D9A2",
            "0x6627e0B690D0BD9fb18bd6eD6A821763dFc3edCf",
            "0x066d437a6EBaBB5896536979c7be50494ba8Dc42",
            "0xdDA91b76a8cEDb62CBA34dF2b1FBf4DfAB2B0a43",
            "0x07fD359fb9BfD46c817b0476E58f77633D08ec44",
            "0x0c2E67b0EAf62e30228475e37D9c501258D13B45",
            "0x171c36b3d740BB6025501Cbd30EaCFa296C13a46",
            "0x09fd204c21D20cc424c14f8eD7ED9639f7ED4247",
            "0x4AE6212cB688174889581D87432D167B5a22Df48",
            "0xc5c2478525Dd7B26487E5Eed49e10B019055b949",
            "0x2410aBa5ab26a7f990A5dC9CF2b022A0BCa6b050",
            "0x403Ed228FF98425365Ac36b7101B390b68888888",
            "\u00000x306f0AcDbA70C03A8fd3Ed48bf033254b06C2c97\u0000",
            "0x924348dEBC80d4D30FCccB944C96a9a63635b7d5\u0000",
            "0xEbcf918c0fE73a2785582E1D4944C56A3636891a\u0000",
            "0xBc1B6cd87349039DdE094372bfD7a8CBb5f280d3\u0000",
            "0x546aBC05d29e63E21Fab17767cF03eD6a097ff7b\u0000",
            "0xc11Ca432F9774b7e4ECFA34b70DF328d46400573\u0000",
            "0x1E77687043Ee5c157b7565CA46375fF47741902C\u0000",
            "0xC770502ce250C5FF1F06f255a0998264Ca1f447D\u0000",
            "0x0d787BC29148b997F444B7f2faf12D3F1ed39Ee3\u0000",
            "0x9004d1C07aE13a8C458b070e619a048d3696c553\u0000"
          ],
          "symbol": "VOTE"
        }
      }
    ],
    "validation": {
      "name": "any"
    },
    "title": "DAO2 投票",
    "body": "",
    "discussion": "",
    "choices": [
      "Crypto 恒哥",
      "twitter@ lezizier"
    ],
    "start": 1690005794,
    "end": 1722405600,
    "quorum": 0,
    "privacy": "",
    "snapshot": "17746741",
    "state": "active",
    "link": "https://snapshot.org/#/cryptoheng.eth/proposal/0x7547cd12eaff6068f592de37cf9f2bca6b98caaed4cab2b70bd5605e239fc252",
    "app": "snapshot",
    "scores": [
      1,
      0
    ],
    "scores_state": "pending",
    "scores_total": 1,
    "scores_updated": 1690005832,
    "votes": 1,
    "flagged": false,
    "space": {
      "id": "cryptoheng.eth"
    }
  }`

	convey.Convey("escaping \\u0000 char", t, func() {
		res := EscapeIllegalCharacters(src)

		convey.So(res, convey.ShouldNotContainSubstring, "\u0000")
		convey.So(res, convey.ShouldNotContainSubstring, "\\u0000")
	})
}
